<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è©¦åˆçµæœå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 900px;
            width: 100%;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: #666;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            bottom: -2px;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .year-link {
            text-align: center;
            margin-bottom: 25px;
        }

        .year-link a {
            color: #667eea;
            text-decoration: none;
            font-size: 13px;
            font-weight: 600;
            padding: 5px 15px;
            border: 2px solid #667eea;
            border-radius: 20px;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .year-link a:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        input[type="text"],
        input[type="date"],
        input[type="time"],
        input[type="number"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="time"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .datetime-group {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
        }

        .score-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: 500;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-message.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .footer-info {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .footer-info h4 {
            color: #666;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .url-display {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #333;
            word-break: break-all;
            line-height: 1.6;
            border: 1px solid #e0e0e0;
        }

        .url-display.not-configured {
            color: #e74c3c;
            font-family: inherit;
            font-style: italic;
        }

        .url-display.configured {
            color: #28a745;
        }

        .preview-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .preview-header h3 {
            margin: 0;
            color: #333;
        }

        .reload-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reload-btn:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }

        .reload-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .preview-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .data-table thead {
            background: #667eea;
            color: white;
        }

        .data-table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            white-space: nowrap;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* å‹æ•—åˆ—ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .result-cell {
            font-weight: 700;
            text-align: center;
        }

        .result-win {
            color: #28a745;
            background: #d4edda;
        }

        .result-lose {
            color: #fd7e14;
            background: #fff3cd;
        }

        .result-draw {
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .loading-state {
            text-align: center;
            padding: 40px 20px;
            color: #667eea;
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-state {
            text-align: center;
            padding: 40px 20px;
            color: #e74c3c;
        }

        .data-count {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }

        .stats-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        .stats-title {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
        }

        @media (max-width: 600px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stat-value {
                font-size: 20px;
            }
        }

        .required {
            color: #e74c3c;
        }

        .config-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .config-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .config-section small {
            color: #666;
            display: block;
            margin-top: 5px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
            }

            h1 {
                font-size: 24px;
            }

            .score-group {
                grid-template-columns: 1fr;
            }

            .tabs {
                gap: 5px;
            }

            .tab {
                padding: 10px 16px;
                font-size: 14px;
            }

            .preview-header {
                justify-content: center;
            }

            .reload-btn {
                width: auto;
            }

            .data-table {
                font-size: 12px;
            }

            .data-table th,
            .data-table td {
                padding: 8px;
            }
        }

        /* ç·¨é›†ãƒ»å‰Šé™¤ãƒœã‚¿ãƒ³ */
        .action-btns {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .edit-btn, .delete-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .edit-btn {
            background: #667eea;
            color: white;
        }

        .edit-btn:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
        }

        .delete-btn:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        .image-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .upload-image-btn {
            background: #27ae60;
            color: white;
        }

        .upload-image-btn:hover {
            background: #229954;
            transform: translateY(-1px);
        }

        .view-image-btn {
            background: #3498db;
            color: white;
        }

        .view-image-btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            margin: 0;
            color: #333;
            font-size: 22px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: #999;
            cursor: pointer;
            line-height: 1;
            padding: 0;
        }

        .close-btn:hover {
            color: #333;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-btn.primary {
            background: #667eea;
            color: white;
        }

        .modal-btn.primary:hover {
            background: #5568d3;
        }

        .modal-btn.secondary {
            background: #e0e0e0;
            color: #333;
        }

        .modal-btn.secondary:hover {
            background: #d0d0d0;
        }

        .modal-btn.danger {
            background: #e74c3c;
            color: white;
        }

        .modal-btn.danger:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ€ è©¦åˆçµæœå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ (2026å¹´åº¦)</h1>
        <p class="subtitle">å—ãƒ¶ä¸˜MBCã®è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²/é–²è¦§</p>
        <div class="year-link">
            <a href="https://upstartman.github.io/minamigaoka/minamigaoka_score.html" target="_blank">ğŸ“… 2025å¹´åº¦ãƒ‡ãƒ¼ã‚¿</a>
        </div>

        <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('form')">ğŸ“ ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</button>
            <button class="tab" onclick="switchTab('preview')">ğŸ“Š ãƒ‡ãƒ¼ã‚¿é–²è¦§</button>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ã‚¿ãƒ– -->
        <div id="formTab" class="tab-content active">
            <form id="matchForm">
            <div class="form-group">
                <label for="date">æ—¥ä»˜ãƒ»è©¦åˆçµ‚äº†æ™‚é–“ <span class="required">*</span></label>
                <div class="datetime-group">
                    <input type="date" id="date" name="date" required />
                    <input type="time" id="endTime" name="endTime" required placeholder="è©¦åˆçµ‚äº†æ™‚é–“" />
                </div>
            </div>

            <div class="form-group">
                <label for="tournament">å¤§ä¼šå <span class="required">*</span></label>
                <input type="text" id="tournament" name="tournament" placeholder="ä¾‹ï¼šç·´ç¿’è©¦åˆ" required />
            </div>

            <div class="form-group">
                <label for="venue">ä¼šå ´ <span class="required">*</span></label>
                <input type="text" id="venue" name="venue" placeholder="ä¾‹ï¼šå—å°å­¦æ ¡" required />
            </div>

            <div class="form-group">
                <label for="opponent">å¯¾æˆ¦ãƒãƒ¼ãƒ å <span class="required">*</span></label>
                <input type="text" id="opponent" name="opponent" placeholder="ä¾‹ï¼šè¥¿ãŒå²¡" required />
            </div>

            <div class="form-group">
                <label>ã‚¹ã‚³ã‚¢ <span class="required">*</span></label>
                <div class="score-group">
                    <div>
                        <input type="number" id="scoreMinamiGaoka" name="scoreMinamiGaoka" placeholder="å—ãƒ¶ä¸˜" min="0" required />
                    </div>
                    <div>
                        <input type="number" id="scoreOpponent" name="scoreOpponent" placeholder="å¯¾æˆ¦ãƒãƒ¼ãƒ " min="0" required />
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="scoresheetImage">ğŸ“· ã‚¹ã‚³ã‚¢ã‚·ãƒ¼ãƒˆç”»åƒ <span style="color: #999; font-weight: normal;">(ä»»æ„)</span></label>
                <input type="file" id="scoresheetImage" name="scoresheetImage" accept="image/*" style="padding: 10px; border: 2px dashed #667eea; border-radius: 8px;" />
                <p style="margin-top: 8px; font-size: 12px; color: #666;">
                    JPG, PNG, JPEGå½¢å¼ï¼ˆæœ€å¤§10MBï¼‰
                </p>
                <div id="imagePreviewBox" style="display: none; margin-top: 10px;">
                    <p style="font-size: 13px; color: #667eea; margin-bottom: 5px;">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:</p>
                    <div style="max-width: 100%; max-height: 200px; overflow: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px; background: #f8f9fa;">
                        <img id="imagePreviewMain" style="max-width: 100%; height: auto;" />
                    </div>
                    <button type="button" onclick="clearImageSelection()" style="margin-top: 8px; padding: 6px 12px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">ç”»åƒã‚’ã‚¯ãƒªã‚¢</button>
                </div>
            </div>

            <button type="submit" class="btn" id="submitBtn">ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ </button>
        </form>

        <div id="statusMessage" class="status-message"></div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ– -->
        <div id="previewTab" class="tab-content">
            <div class="preview-header">
                <button class="reload-btn" onclick="loadPreviewData()">ğŸ”„ æ›´æ–°</button>
            </div>
            
            <div id="previewContent">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
                </div>
            </div>
            
            <div class="data-count" id="dataCount"></div>
        </div>

        <div class="footer-info">
            <h4>ğŸ“¡ è¨­å®šæƒ…å ±</h4>
            <div id="urlDisplay" class="url-display"></div>
        </div>
    </div>

    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âœï¸ ãƒ‡ãƒ¼ã‚¿ã‚’ç·¨é›†</h2>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            <form id="editForm">
                <input type="hidden" id="editRowIndex">
                
                <div class="form-group">
                    <label for="editDate">æ—¥ä»˜ã¨è©¦åˆçµ‚äº†æ™‚é–“ <span class="required">*</span></label>
                    <div class="datetime-group">
                        <input type="date" id="editDate" required />
                        <input type="time" id="editEndTime" required />
                    </div>
                </div>

                <div class="form-group">
                    <label for="editTournament">å¤§ä¼šå <span class="required">*</span></label>
                    <input type="text" id="editTournament" required />
                </div>

                <div class="form-group">
                    <label for="editVenue">ä¼šå ´ <span class="required">*</span></label>
                    <input type="text" id="editVenue" required />
                </div>

                <div class="form-group">
                    <label for="editOpponent">å¯¾æˆ¦ãƒãƒ¼ãƒ å <span class="required">*</span></label>
                    <input type="text" id="editOpponent" required />
                </div>

                <div class="form-group">
                    <label>ã‚¹ã‚³ã‚¢ <span class="required">*</span></label>
                    <div class="score-group">
                        <div>
                            <input type="number" id="editScoreMinamiGaoka" placeholder="å—ãƒ¶ä¸˜" min="0" required />
                        </div>
                        <div>
                            <input type="number" id="editScoreOpponent" placeholder="å¯¾æˆ¦ãƒãƒ¼ãƒ " min="0" required />
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="modal-btn secondary" onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit" class="modal-btn primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</h2>
                <button class="close-btn" onclick="closeDeleteModal()">&times;</button>
            </div>
            <p style="margin: 20px 0; color: #666;">ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</p>
            <div id="deletePreview" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;"></div>
            <input type="hidden" id="deleteRowIndex">
            <div class="modal-actions">
                <button type="button" class="modal-btn secondary" onclick="closeDeleteModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button type="button" class="modal-btn danger" onclick="confirmDelete()">å‰Šé™¤</button>
            </div>
        </div>
    </div>

    <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="imageUploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“· ã‚¹ã‚³ã‚¢ã‚·ãƒ¼ãƒˆç”»åƒã‚’è¿½åŠ </h2>
                <button class="close-btn" onclick="closeImageUploadModal()">&times;</button>
            </div>
            <div id="imageUploadInfo" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;"></div>
            <input type="hidden" id="imageUploadRowIndex">
            
            <div class="form-group">
                <label for="imageFileInput">ç”»åƒã‚’é¸æŠ <span class="required">*</span></label>
                <input type="file" id="imageFileInput" accept="image/*" required style="padding: 10px; border: 2px dashed #667eea; border-radius: 8px;" />
                <p style="margin-top: 8px; font-size: 12px; color: #666;">JPG, PNG, JPEGå½¢å¼ã®ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™</p>
            </div>
            
            <div id="imagePreviewContainer" style="display: none; margin: 15px 0;">
                <label>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:</label>
                <div style="max-width: 100%; max-height: 400px; overflow: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px; background: #f8f9fa;">
                    <img id="imagePreview" style="max-width: 100%; height: auto;" />
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="modal-btn secondary" onclick="closeImageUploadModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button type="button" class="modal-btn primary" onclick="uploadImage()">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
            </div>
        </div>
    </div>

    <!-- ç”»åƒè¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="imageViewModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>ğŸ“· ã‚¹ã‚³ã‚¢ã‚·ãƒ¼ãƒˆç”»åƒ</h2>
                <button class="close-btn" onclick="closeImageViewModal()">&times;</button>
            </div>
            <div id="imageViewInfo" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;"></div>
            <input type="hidden" id="imageViewRowIndex">
            <input type="hidden" id="imageViewUrl">
            
            <div style="max-width: 100%; max-height: 600px; overflow: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px; background: #f8f9fa; margin: 15px 0;">
                <img id="imageViewDisplay" style="max-width: 100%; height: auto;" />
            </div>
            
            <div class="modal-actions">
                <button type="button" class="modal-btn secondary" onclick="closeImageViewModal()">é–‰ã˜ã‚‹</button>
                <a id="imageDownloadLink" class="modal-btn primary" download style="text-decoration: none; display: inline-block;">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
                <button type="button" class="modal-btn upload-image-btn" onclick="replaceImage()">ğŸ“· ç”»åƒã‚’å¤‰æ›´</button>
            </div>
        </div>
    </div>

    <script>
        // ===== è¨­å®š: ã“ã“ã«Google Apps Script URLã‚’è¨­å®šã—ã¦ãã ã•ã„ =====
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzbbJspIg12KxGgQV5hbDf8KP1PL_qm29CX4lJFL8Borq5iK39bIc4V2-OHZkXf7Q95/exec';
        // ============================================================

        // LocalStorageã‹ã‚‰å€¤ã‚’èª­ã¿è¾¼ã¿
        window.addEventListener('DOMContentLoaded', () => {
            // å¤§ä¼šåã¨ä¼šå ´åã‚’å¾©å…ƒ
            const savedTournament = localStorage.getItem('tournament');
            if (savedTournament) {
                document.getElementById('tournament').value = savedTournament;
            }

            const savedVenue = localStorage.getItem('venue');
            if (savedVenue) {
                document.getElementById('venue').value = savedVenue;
            }

            // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¨­å®š
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;

            // ç¾åœ¨æ™‚åˆ»ã‚’è©¦åˆçµ‚äº†æ™‚é–“ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦è¨­å®š
            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2, '0') + ':' + 
                              now.getMinutes().toString().padStart(2, '0');
            document.getElementById('endTime').value = currentTime;

            // URLæƒ…å ±ã‚’è¡¨ç¤º
            displayScriptUrl();
            
            // ç”»åƒé¸æŠæ™‚ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
            document.getElementById('scoresheetImage').addEventListener('change', function(e) {
                const file = e.target.files[0];
                const previewBox = document.getElementById('imagePreviewBox');
                const previewImg = document.getElementById('imagePreviewMain');
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        previewImg.src = event.target.result;
                        previewBox.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    previewBox.style.display = 'none';
                }
            });
        });
        
        // ç”»åƒé¸æŠã‚’ã‚¯ãƒªã‚¢
        function clearImageSelection() {
            const fileInput = document.getElementById('scoresheetImage');
            const previewBox = document.getElementById('imagePreviewBox');
            fileInput.value = '';
            previewBox.style.display = 'none';
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
            if (tabName === 'form') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('formTab').classList.add('active');
            } else if (tabName === 'preview') {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('previewTab').classList.add('active');
                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ–ã‚’é–‹ã„ãŸã¨ãã«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
                loadPreviewData();
            }
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
        async function loadPreviewData() {
            if (!SCRIPT_URL || SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                showPreviewError('Google Apps Script URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            const previewContent = document.getElementById('previewContent');
            const dataCount = document.getElementById('dataCount');
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            previewContent.innerHTML = `
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
                </div>
            `;
            dataCount.textContent = '';

            try {
                const response = await fetch(SCRIPT_URL);
                const result = await response.json();

                if (result.status === 'success') {
                    if (result.data && result.data.length > 0) {
                        // æ—¥ä»˜ã¨è©¦åˆçµ‚äº†æ™‚é–“ã§ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„é †ï¼‰
                        const sortedData = result.data.sort((a, b) => {
                            // æ—¥ä»˜æ–‡å­—åˆ—ã‚’YYYY-MM-DDå½¢å¼ã«æ­£è¦åŒ–
                            const dateA = a.date.replace(/\//g, '-');
                            const dateB = b.date.replace(/\//g, '-');
                            
                            // æ—¥ä»˜ã¨æ™‚é–“ã‚’çµ„ã¿åˆã‚ã›ã¦æ¯”è¼ƒ
                            const datetimeA = dateA + ' ' + (a.endTime || '00:00');
                            const datetimeB = dateB + ' ' + (b.endTime || '00:00');
                            
                            // é™é †ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„ã‚‚ã®ãŒä¸Šï¼‰
                            return datetimeB.localeCompare(datetimeA);
                        });
                        
                        displayPreviewData(sortedData, result.stats);
                        dataCount.textContent = `${result.count}ä»¶ã®ãƒ‡ãƒ¼ã‚¿`;
                    } else {
                        showPreviewEmpty();
                    }
                } else {
                    showPreviewError(result.message || 'ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('Preview error:', error);
                showPreviewError('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
        function displayPreviewData(data, stats) {
            const previewContent = document.getElementById('previewContent');
            
            let html = '';
            
            // é›†è¨ˆæƒ…å ±ã‚’è¡¨ç¤ºï¼ˆJ1~N2ï¼‰
            if (stats && stats.length === 2) {
                const labels = stats[0]; // 1è¡Œç›®ï¼šãƒ©ãƒ™ãƒ«
                const values = stats[1]; // 2è¡Œç›®ï¼šå€¤
                
                html += `
                    <div class="stats-container">
                        <h3 class="stats-title">ğŸ“Š é›†è¨ˆæƒ…å ±</h3>
                        <div class="stats-grid">
                `;
                
                for (let i = 0; i < labels.length && i < values.length; i++) {
                    if (labels[i] !== '' || values[i] !== '') {
                        const label = String(labels[i]);
                        let value = values[i];
                        
                        // å‹ç‡ã®å ´åˆã¯ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆè¡¨ç¤ºã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
                        if (label.includes('å‹ç‡') || label.toLowerCase().includes('rate') || label.toLowerCase().includes('win')) {
                            value = formatPercentage(value);
                        } else {
                            value = String(value);
                        }
                        
                        html += `
                            <div class="stat-item">
                                <div class="stat-label">${escapeHtml(label)}</div>
                                <div class="stat-value">${escapeHtml(value)}</div>
                            </div>
                        `;
                    }
                }
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤º
            html += `
                <div class="preview-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ—¥ä»˜</th>
                                <th>çµ‚äº†æ™‚é–“</th>
                                <th>å¤§ä¼šå</th>
                                <th>ä¼šå ´</th>
                                <th>å¯¾æˆ¦ãƒãƒ¼ãƒ </th>
                                <th>å—ãƒ¶ä¸˜</th>
                                <th>å¯¾æˆ¦ç›¸æ‰‹</th>
                                <th>å‹æ•—</th>
                                <th>ç”»åƒ</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach(row => {
                // æ—¥ä»˜ã‚’ã‚¹ãƒ©ãƒƒã‚·ãƒ¥åŒºåˆ‡ã‚Šã«å¤‰æ›
                const formattedDate = formatDateForDisplay(row.date);
                // æ™‚åˆ»ã‚’HH:MMå½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
                const formattedTime = formatTimeForDisplay(row.endTime);
                
                // å‹æ•—ã«å¿œã˜ãŸã‚¯ãƒ©ã‚¹ã‚’æ±ºå®š
                const result = String(row.result || '').trim();
                let resultClass = 'result-cell';
                if (result === 'å‹' || result === 'å‹ã¡') {
                    resultClass += ' result-win';
                } else if (result === 'è² ' || result === 'è² ã‘') {
                    resultClass += ' result-lose';
                } else if (result === 'å¼•ãåˆ†ã‘' || result === 'åˆ†') {
                    resultClass += ' result-draw';
                }
                
                html += `
                    <tr>
                        <td>${escapeHtml(formattedDate)}</td>
                        <td>${escapeHtml(formattedTime)}</td>
                        <td>${escapeHtml(row.tournament)}</td>
                        <td>${escapeHtml(row.venue)}</td>
                        <td>${escapeHtml(row.opponent)}</td>
                        <td>${escapeHtml(row.scoreMinamiGaoka)}</td>
                        <td>${escapeHtml(row.scoreOpponent)}</td>
                        <td class="${resultClass}">${escapeHtml(result)}</td>
                        <td>
                            ${row.imageUrl ? 
                                `<button class="image-btn view-image-btn" onclick='viewImage("${row.imageUrl}", ${JSON.stringify(row)})'>ğŸ“· è¡¨ç¤º</button>` : 
                                `<button class="image-btn upload-image-btn" onclick='openImageUploadModal(${JSON.stringify(row)})'>ğŸ“· è¿½åŠ </button>`
                            }
                        </td>
                        <td>
                            <div class="action-btns">
                                <button class="edit-btn" onclick='openEditModal(${JSON.stringify(row)})'>ç·¨é›†</button>
                                <button class="delete-btn" onclick='openDeleteModal(${JSON.stringify(row)})'>å‰Šé™¤</button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            previewContent.innerHTML = html;
        }

        // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆè¡¨ç¤ºã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆå°æ•°ç‚¹ä»¥ä¸‹2æ¡ï¼‰
        function formatPercentage(value) {
            if (value === '' || value === null || value === undefined) {
                return '';
            }
            
            try {
                let numValue = parseFloat(value);
                
                // æ—¢ã«ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆå€¤ï¼ˆ0-100ã®ç¯„å›²ï¼‰ã®å ´åˆ
                if (numValue > 1) {
                    return numValue.toFixed(2) + '%';
                }
                
                // å°æ•°ï¼ˆ0-1ã®ç¯„å›²ï¼‰ã®å ´åˆã¯100å€ã—ã¦ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆè¡¨ç¤º
                return (numValue * 100).toFixed(2) + '%';
            } catch (error) {
                // æ•°å€¤ã«å¤‰æ›ã§ããªã„å ´åˆã¯ãã®ã¾ã¾è¿”ã™
                return String(value);
            }
        }

        // æ—¥ä»˜ã‚’YYYY/MM/DDå½¢å¼ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatDateForDisplay(dateStr) {
            if (!dateStr) return '';
            
            try {
                // æ—¢ã«YYYY/MM/DDå½¢å¼ã®å ´åˆã¯ãã®ã¾ã¾è¿”ã™
                if (/^\d{4}\/\d{2}\/\d{2}$/.test(dateStr)) {
                    return dateStr;
                }
                
                // YYYY-MM-DDå½¢å¼ã®å ´åˆã¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã«å¤‰æ›
                if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) {
                    return dateStr.replace(/-/g, '/');
                }
                
                // ISOå½¢å¼ï¼ˆYYYY-MM-DDTHH:mm:ss.sssZï¼‰ã®å ´åˆ
                if (dateStr.includes('T')) {
                    const date = new Date(dateStr);
                    if (!isNaN(date.getTime())) {
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        return `${year}/${month}/${day}`;
                    }
                }
                
                // ãã®ä»–ã®å½¢å¼ã®å ´åˆã‚‚Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ãƒ‘ãƒ¼ã‚¹
                const date = new Date(dateStr);
                if (!isNaN(date.getTime())) {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}/${month}/${day}`;
                }
                
                // ãƒ‘ãƒ¼ã‚¹ã§ããªã„å ´åˆã¯å…ƒã®æ–‡å­—åˆ—ã‚’è¿”ã™
                return dateStr;
            } catch (error) {
                console.error('Date formatting error:', error);
                return dateStr;
            }
        }

        // æ™‚åˆ»ã‚’HH:MMå½¢å¼ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatTimeForDisplay(timeStr) {
            if (!timeStr || timeStr === '') return '';
            
            try {
                // æ—¢ã«HH:MMå½¢å¼ã®å ´åˆã¯ãã®ã¾ã¾è¿”ã™
                if (/^\d{1,2}:\d{2}$/.test(timeStr)) {
                    return timeStr;
                }
                
                // ISOå½¢å¼ï¼ˆ1899-12-30T06:26:00.000Zãªã©ï¼‰ã®å ´åˆ
                if (typeof timeStr === 'string' && timeStr.includes('T')) {
                    const date = new Date(timeStr);
                    if (!isNaN(date.getTime())) {
                        const hours = String(date.getHours()).padStart(2, '0');
                        const minutes = String(date.getMinutes()).padStart(2, '0');
                        return `${hours}:${minutes}`;
                    }
                }
                
                // ãã®ä»–ã®å ´åˆã¯ãã®ã¾ã¾è¿”ã™
                return timeStr;
            } catch (error) {
                console.error('Time formatting error:', error);
                return timeStr;
            }
        }

        // ç©ºã®ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
        function showPreviewEmpty() {
            const previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“­</div>
                    <p>ãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</p>
                    <p style="font-size: 14px; color: #999;">ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ã‚¿ãƒ–ã‹ã‚‰è©¦åˆçµæœã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>
                </div>
            `;
        }

        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        function showPreviewError(message) {
            const previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = `
                <div class="error-state">
                    <div class="empty-state-icon">âš ï¸</div>
                    <p>${escapeHtml(message)}</p>
                </div>
            `;
        }

        // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // å¤§ä¼šåã®ä¿å­˜
        const tournamentInput = document.getElementById('tournament');
        tournamentInput.addEventListener('blur', (e) => {
            if (e.target.value.trim() !== '') {
                localStorage.setItem('tournament', e.target.value.trim());
            }
        });
        tournamentInput.addEventListener('change', (e) => {
            if (e.target.value.trim() !== '') {
                localStorage.setItem('tournament', e.target.value.trim());
            }
        });

        // ä¼šå ´åã®ä¿å­˜
        const venueInput = document.getElementById('venue');
        venueInput.addEventListener('blur', (e) => {
            if (e.target.value.trim() !== '') {
                localStorage.setItem('venue', e.target.value.trim());
            }
        });
        venueInput.addEventListener('change', (e) => {
            if (e.target.value.trim() !== '') {
                localStorage.setItem('venue', e.target.value.trim());
            }
        });

        document.getElementById('matchForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            // URLãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
            if (!SCRIPT_URL || SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                showMessage('ã‚¨ãƒ©ãƒ¼: HTMLãƒ•ã‚¡ã‚¤ãƒ«å†…ã®SCRIPT_URLã‚’è¨­å®šã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const formData = {
                action: 'add',
                date: document.getElementById('date').value,
                endTime: document.getElementById('endTime').value,
                tournament: document.getElementById('tournament').value,
                venue: document.getElementById('venue').value,
                opponent: document.getElementById('opponent').value,
                scoreMinamiGaoka: document.getElementById('scoreMinamiGaoka').value,
                scoreOpponent: document.getElementById('scoreOpponent').value
            };

            const submitBtn = document.getElementById('submitBtn');
            const imageFile = document.getElementById('scoresheetImage').files[0];
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'é€ä¿¡ä¸­...';

            try {
                console.log('=== ãƒ‡ãƒ¼ã‚¿è¿½åŠ é–‹å§‹ ===');
                console.log('ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿:', formData);
                
                // ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                console.log('ãƒ‡ãƒ¼ã‚¿è¿½åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡å®Œäº†');
                
                // ãƒ‡ãƒ¼ã‚¿ãŒç¢ºå®Ÿã«ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¿½åŠ ã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ
                if (imageFile) {
                    console.log('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚ã‚Šã€‚ãƒ‡ãƒ¼ã‚¿è¿½åŠ å®Œäº†ã‚’å¾…æ©Ÿä¸­...');
                    showMessage('ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...', 'success');
                    submitBtn.textContent = 'ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...';
                    
                    // ãƒ‡ãƒ¼ã‚¿è¿½åŠ ãŒå®Œäº†ã™ã‚‹ã¾ã§3ç§’å¾…æ©Ÿ
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    console.log('=== ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–‹å§‹ ===');
                    await uploadImageWithData(imageFile);
                    console.log('=== ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº† ===');
                    
                    showMessage('ãƒ‡ãƒ¼ã‚¿ã¨ç”»åƒã‚’è¿½åŠ ã—ã¾ã—ãŸï¼', 'success');
                } else {
                    showMessage('ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼', 'success');
                }
                
                // å¯¾æˆ¦ãƒãƒ¼ãƒ åã¨ã‚¹ã‚³ã‚¢ã®ã¿ã‚¯ãƒªã‚¢ï¼ˆå¤§ä¼šåã¨ä¼šå ´åã¯ä¿æŒï¼‰
                document.getElementById('opponent').value = '';
                document.getElementById('scoreMinamiGaoka').value = '';
                document.getElementById('scoreOpponent').value = '';
                
                // ç”»åƒå…¥åŠ›ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ã‚¯ãƒªã‚¢
                clearImageSelection();
                
                // æ—¥ä»˜ã‚’ä»Šæ—¥ã«æˆ»ã™
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('date').value = today;

                // ç¾åœ¨æ™‚åˆ»ã‚’è©¦åˆçµ‚äº†æ™‚é–“ã«ãƒªã‚»ãƒƒãƒˆ
                const now = new Date();
                const currentTime = now.getHours().toString().padStart(2, '0') + ':' + 
                                  now.getMinutes().toString().padStart(2, '0');
                document.getElementById('endTime').value = currentTime;

                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ–ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆã¯æ›´æ–°ï¼ˆç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†ã‚’å¾…ã¤ï¼‰
                const waitTime = imageFile ? 5000 : 1000;
                setTimeout(() => {
                    if (document.getElementById('previewTab').classList.contains('active')) {
                        loadPreviewData();
                    }
                }, waitTime);

            } catch (error) {
                console.error('Error:', error);
                showMessage('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚URLã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ';
            }
        });
        
        // ãƒ‡ãƒ¼ã‚¿è¿½åŠ æ™‚ã®ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        async function uploadImageWithData(file) {
            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ10MBä»¥ä¸‹ï¼‰
            if (file.size > 10 * 1024 * 1024) {
                console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚¨ãƒ©ãƒ¼:', file.size);
                showMessage('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ï¼ˆ10MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ï¼‰', 'error');
                return;
            }
            
            try {
                console.log('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±:', {
                    name: file.name,
                    size: file.size,
                    type: file.type
                });
                
                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Base64ã«å¤‰æ›
                const base64Data = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => {
                        console.log('Base64å¤‰æ›å®Œäº†');
                        resolve(reader.result);
                    };
                    reader.onerror = () => {
                        console.error('ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼');
                        reject(new Error('ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼'));
                    };
                    reader.readAsDataURL(file);
                });
                
                const uploadData = {
                    action: 'upload_image',
                    rowIndex: 2, // æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸè¡Œã¯å¸¸ã«2è¡Œç›®
                    imageData: base64Data,
                    fileName: file.name,
                    mimeType: file.type
                };
                
                console.log('ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡:', {
                    action: uploadData.action,
                    rowIndex: uploadData.rowIndex,
                    fileName: uploadData.fileName,
                    mimeType: uploadData.mimeType,
                    dataLength: base64Data.length
                });
                
                // Google Apps Scriptã«é€ä¿¡ï¼ˆ2è¡Œç›®ã«ç”»åƒã‚’ç´ã¥ã‘ã‚‹ï¼‰
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(uploadData),
                    mode: 'no-cors'
                });
                
                console.log('ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡å®Œäº†');
                
                // no-corsãƒ¢ãƒ¼ãƒ‰ãªã®ã§ã€Google Apps Scriptã®ãƒ­ã‚°ã§çµæœã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚‹
                console.log('âš ï¸ no-corsãƒ¢ãƒ¼ãƒ‰ã®ãŸã‚ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çµæœã¯ç¢ºèªã§ãã¾ã›ã‚“');
                console.log('Google Apps Scriptã®å®Ÿè¡Œãƒ­ã‚°ã§çµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                
            } catch (error) {
                console.error('Image upload error:', error);
                showMessage('ãƒ‡ãƒ¼ã‚¿ã¯è¿½åŠ ã•ã‚Œã¾ã—ãŸãŒã€ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                throw error;
            }
        }

        function showMessage(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${type} show`;
            
            setTimeout(() => {
                statusDiv.classList.remove('show');
            }, 5000);
        }

        function displayScriptUrl() {
            const urlDisplay = document.getElementById('urlDisplay');
            
            if (!SCRIPT_URL || SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                urlDisplay.textContent = 'âš ï¸ Google Apps Script URLãŒæœªè¨­å®šã§ã™ã€‚HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦SCRIPT_URLã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚';
                urlDisplay.className = 'url-display not-configured';
            } else {
                urlDisplay.textContent = `âœ“ æ¥ç¶šå…ˆ: ${SCRIPT_URL}`;
                urlDisplay.className = 'url-display configured';
            }
        }

        // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openEditModal(row) {
            document.getElementById('editRowIndex').value = row.rowIndex;
            document.getElementById('editDate').value = row.date.replace(/\//g, '-');
            document.getElementById('editEndTime').value = row.endTime || '';
            document.getElementById('editTournament').value = row.tournament;
            document.getElementById('editVenue').value = row.venue;
            document.getElementById('editOpponent').value = row.opponent;
            document.getElementById('editScoreMinamiGaoka').value = row.scoreMinamiGaoka;
            document.getElementById('editScoreOpponent').value = row.scoreOpponent;
            
            document.getElementById('editModal').classList.add('show');
        }

        // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
        }

        // ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡
        document.getElementById('editForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!SCRIPT_URL || SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                showMessage('ã‚¨ãƒ©ãƒ¼: HTMLãƒ•ã‚¡ã‚¤ãƒ«å†…ã®SCRIPT_URLã‚’è¨­å®šã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const formData = {
                action: 'edit',
                rowIndex: parseInt(document.getElementById('editRowIndex').value),
                date: document.getElementById('editDate').value,
                endTime: document.getElementById('editEndTime').value,
                tournament: document.getElementById('editTournament').value,
                venue: document.getElementById('editVenue').value,
                opponent: document.getElementById('editOpponent').value,
                scoreMinamiGaoka: document.getElementById('editScoreMinamiGaoka').value,
                scoreOpponent: document.getElementById('editScoreOpponent').value
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                showMessage('ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼', 'success');
                closeEditModal();
                
                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
                setTimeout(() => {
                    loadPreviewData();
                }, 1000);

            } catch (error) {
                console.error('Error:', error);
                showMessage('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚', 'error');
            }
        });

        // å‰Šé™¤ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openDeleteModal(row) {
            document.getElementById('deleteRowIndex').value = row.rowIndex;
            
            const dateDisplay = row.date + (row.endTime ? ' ' + row.endTime : '');
            const preview = document.getElementById('deletePreview');
            preview.innerHTML = `
                <p style="margin: 5px 0;"><strong>æ—¥ä»˜:</strong> ${escapeHtml(dateDisplay)}</p>
                <p style="margin: 5px 0;"><strong>å¤§ä¼šå:</strong> ${escapeHtml(row.tournament)}</p>
                <p style="margin: 5px 0;"><strong>å¯¾æˆ¦ãƒãƒ¼ãƒ :</strong> ${escapeHtml(row.opponent)}</p>
                <p style="margin: 5px 0;"><strong>ã‚¹ã‚³ã‚¢:</strong> ${escapeHtml(row.scoreMinamiGaoka)} - ${escapeHtml(row.scoreOpponent)}</p>
            `;
            
            document.getElementById('deleteModal').classList.add('show');
        }

        // å‰Šé™¤ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.remove('show');
        }

        // å‰Šé™¤ã‚’å®Ÿè¡Œ
        async function confirmDelete() {
            if (!SCRIPT_URL || SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                showMessage('ã‚¨ãƒ©ãƒ¼: HTMLãƒ•ã‚¡ã‚¤ãƒ«å†…ã®SCRIPT_URLã‚’è¨­å®šã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const rowIndex = parseInt(document.getElementById('deleteRowIndex').value);

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'delete',
                        rowIndex: rowIndex
                    })
                });

                showMessage('ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼', 'success');
                closeDeleteModal();
                
                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
                setTimeout(() => {
                    loadPreviewData();
                }, 1000);

            } catch (error) {
                console.error('Error:', error);
                showMessage('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚', 'error');
            }
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        window.onclick = function(event) {
            const editModal = document.getElementById('editModal');
            const deleteModal = document.getElementById('deleteModal');
            const imageUploadModal = document.getElementById('imageUploadModal');
            const imageViewModal = document.getElementById('imageViewModal');
            
            if (event.target == editModal) {
                closeEditModal();
            }
            if (event.target == deleteModal) {
                closeDeleteModal();
            }
            if (event.target == imageUploadModal) {
                closeImageUploadModal();
            }
            if (event.target == imageViewModal) {
                closeImageViewModal();
            }
        }

        // ===== ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–¢é€£ã®é–¢æ•° =====
        
        /**
         * Google Driveã®URLã‚’ç›´æ¥è¡¨ç¤ºå¯èƒ½ãªå½¢å¼ã«å¤‰æ›
         * è¤‡æ•°ã®å½¢å¼ã‚’è©¦ã—ã¦æœ€ã‚‚ç¢ºå®Ÿãªæ–¹æ³•ã‚’ä½¿ç”¨
         */
        function convertToDirectImageUrl(url) {
            if (!url) return '';
            
            // æ—¢ã«ç›´æ¥è¡¨ç¤ºå½¢å¼ã®å ´åˆã¯ãã®ã¾ã¾è¿”ã™
            if (url.includes('drive.google.com/uc?export=view&id=') || 
                url.includes('drive.google.com/thumbnail?id=')) {
                return url;
            }
            
            // FILE_IDã‚’æŠ½å‡º
            let fileId = null;
            
            // ãƒ‘ã‚¿ãƒ¼ãƒ³1: https://drive.google.com/file/d/FILE_ID/view
            const pattern1 = /drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/;
            const match1 = url.match(pattern1);
            if (match1) {
                fileId = match1[1];
            }
            
            // ãƒ‘ã‚¿ãƒ¼ãƒ³2: https://drive.google.com/open?id=FILE_ID
            const pattern2 = /drive\.google\.com\/open\?id=([a-zA-Z0-9_-]+)/;
            const match2 = url.match(pattern2);
            if (match2) {
                fileId = match2[1];
            }
            
            // ãƒ‘ã‚¿ãƒ¼ãƒ³3: URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰idå–å¾—
            const pattern3 = /[?&]id=([a-zA-Z0-9_-]+)/;
            const match3 = url.match(pattern3);
            if (match3) {
                fileId = match3[1];
            }
            
            // ãƒ•ã‚¡ã‚¤ãƒ«IDãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã€ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºURLã«å¤‰æ›ï¼ˆã‚ˆã‚Šç¢ºå®Ÿï¼‰
            if (fileId) {
                // ã‚µãƒ ãƒã‚¤ãƒ«å½¢å¼ï¼ˆæœ€ã‚‚ç¢ºå®Ÿã«è¡¨ç¤ºã§ãã‚‹ï¼‰
                return `https://drive.google.com/thumbnail?id=${fileId}&sz=w1000`;
            }
            
            // å¤‰æ›ã§ããªã„å ´åˆã¯å…ƒã®URLã‚’è¿”ã™
            console.warn('URLã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«IDã‚’æŠ½å‡ºã§ãã¾ã›ã‚“ã§ã—ãŸ:', url);
            return url;
        }
        
        // ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openImageUploadModal(rowData) {
            const modal = document.getElementById('imageUploadModal');
            const infoDiv = document.getElementById('imageUploadInfo');
            const rowIndexInput = document.getElementById('imageUploadRowIndex');
            const fileInput = document.getElementById('imageFileInput');
            const previewContainer = document.getElementById('imagePreviewContainer');
            
            // è¡Œç•ªå·ã‚’ä¿å­˜
            rowIndexInput.value = rowData.rowIndex;
            
            // è©¦åˆæƒ…å ±ã‚’è¡¨ç¤º
            infoDiv.innerHTML = `
                <strong>è©¦åˆæƒ…å ±:</strong><br>
                æ—¥ä»˜: ${escapeHtml(formatDateForDisplay(rowData.date))} ${escapeHtml(rowData.endTime)}<br>
                å¤§ä¼šå: ${escapeHtml(rowData.tournament)}<br>
                å¯¾æˆ¦ç›¸æ‰‹: ${escapeHtml(rowData.opponent)}
            `;
            
            // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
            fileInput.value = '';
            previewContainer.style.display = 'none';
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            modal.style.display = 'block';
        }
        
        // ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeImageUploadModal() {
            const modal = document.getElementById('imageUploadModal');
            modal.style.display = 'none';
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ™‚ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
        document.getElementById('imageFileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const preview = document.getElementById('imagePreview');
                    const container = document.getElementById('imagePreviewContainer');
                    preview.src = event.target.result;
                    container.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
        
        // ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        async function uploadImage() {
            const fileInput = document.getElementById('imageFileInput');
            const rowIndex = document.getElementById('imageUploadRowIndex').value;
            
            if (!fileInput.files || fileInput.files.length === 0) {
                showMessage('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            
            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ10MBä»¥ä¸‹ï¼‰
            if (file.size > 10 * 1024 * 1024) {
                showMessage('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ï¼ˆ10MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ï¼‰', 'error');
                return;
            }
            
            try {
                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Base64ã«å¤‰æ›
                const reader = new FileReader();
                reader.onload = async function(e) {
                    const base64Data = e.target.result;
                    
                    // Google Apps Scriptã«é€ä¿¡
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'upload_image',
                            rowIndex: parseInt(rowIndex),
                            imageData: base64Data,
                            fileName: file.name,
                            mimeType: file.type
                        }),
                        mode: 'no-cors'
                    });
                    
                    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ
                    showMessage('ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼', 'success');
                    closeImageUploadModal();
                    
                    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°ï¼ˆGoogle Driveã®å…±æœ‰è¨­å®šåæ˜ ã‚’å¾…ã¤ãŸã‚3ç§’å¾…æ©Ÿï¼‰
                    setTimeout(() => {
                        loadPreviewData();
                    }, 3000);
                };
                reader.readAsDataURL(file);
                
            } catch (error) {
                console.error('Error:', error);
                showMessage('ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        // ç”»åƒã‚’è¡¨ç¤º
        function viewImage(imageUrl, rowData) {
            const modal = document.getElementById('imageViewModal');
            const infoDiv = document.getElementById('imageViewInfo');
            const rowIndexInput = document.getElementById('imageViewRowIndex');
            const imageUrlInput = document.getElementById('imageViewUrl');
            const imageDisplay = document.getElementById('imageViewDisplay');
            const downloadLink = document.getElementById('imageDownloadLink');
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šå…ƒã®URLã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
            console.log('å…ƒã®ç”»åƒURL:', imageUrl);
            
            // è¡Œç•ªå·ã¨URLã‚’ä¿å­˜
            rowIndexInput.value = rowData.rowIndex;
            imageUrlInput.value = imageUrl;
            
            // è©¦åˆæƒ…å ±ã‚’è¡¨ç¤º
            infoDiv.innerHTML = `
                <strong>è©¦åˆæƒ…å ±:</strong><br>
                æ—¥ä»˜: ${escapeHtml(formatDateForDisplay(rowData.date))} ${escapeHtml(rowData.endTime)}<br>
                å¤§ä¼šå: ${escapeHtml(rowData.tournament)}<br>
                å¯¾æˆ¦ç›¸æ‰‹: ${escapeHtml(rowData.opponent)}
            `;
            
            // URLã‚’ç›´æ¥è¡¨ç¤ºå¯èƒ½ãªå½¢å¼ã«å¤‰æ›
            const directImageUrl = convertToDirectImageUrl(imageUrl);
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šå¤‰æ›å¾Œã®URLã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
            console.log('å¤‰æ›å¾Œã®ç”»åƒURL:', directImageUrl);
            
            // ç”»åƒã‚’è¡¨ç¤º
            imageDisplay.src = directImageUrl;
            
            // ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            imageDisplay.onerror = function() {
                console.error('ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', directImageUrl);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã«ä»£æ›¿ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º
                infoDiv.innerHTML += `<br><span style="color: red;">âš ï¸ ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚URLã‚’ã”ç¢ºèªãã ã•ã„ã€‚</span><br>URL: ${directImageUrl}`;
            };
            
            imageDisplay.onload = function() {
                console.log('ç”»åƒã®èª­ã¿è¾¼ã¿ã«æˆåŠŸã—ã¾ã—ãŸ');
            };
            
            downloadLink.href = directImageUrl;
            downloadLink.download = `scoresheet_${rowData.date}_${rowData.opponent}.jpg`;
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            modal.style.display = 'block';
        }
        
        // ç”»åƒè¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeImageViewModal() {
            const modal = document.getElementById('imageViewModal');
            modal.style.display = 'none';
        }
        
        // ç”»åƒã‚’å¤‰æ›´ï¼ˆæ—¢å­˜ã®ç”»åƒã‚’ç½®ãæ›ãˆï¼‰
        function replaceImage() {
            const rowIndex = document.getElementById('imageViewRowIndex').value;
            const rowData = { rowIndex: parseInt(rowIndex) };
            
            // ç”»åƒè¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            closeImageViewModal();
            
            // ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
            // ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ã—ã¦ã‹ã‚‰é–‹ã
            const previewContent = document.getElementById('previewContent');
            // ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ç›´ã—ã¦ã‹ã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãï¼ˆç°¡æ˜“çš„ã«å†èª­ã¿è¾¼ã¿ï¼‰
            setTimeout(() => {
                loadPreviewData().then(() => {
                    // ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚ŒãŸã‚‰ã€è©²å½“è¡Œã®ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã¤ã‘ã¦ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
                    // ã“ã“ã§ã¯ç°¡æ˜“çš„ã«è¡Œç•ªå·ã ã‘ã§å‡¦ç†
                    const simpleRowData = {
                        rowIndex: parseInt(rowIndex),
                        date: '',
                        endTime: '',
                        tournament: 'ï¼ˆç”»åƒã‚’å¤‰æ›´ä¸­ï¼‰',
                        opponent: ''
                    };
                    openImageUploadModal(simpleRowData);
                });
            }, 100);
        }
    </script>
</body>
</html>
